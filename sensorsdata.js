function e(a,b,c){if(a[b]){var d=a[b];a[b]=function(a){c.call(this,a,b),d.call(this,a)}}else a[b]=function(a){c.call(this,a,b)}}function appLaunch(){this[sa.para.name]=sa,sa.init()}function appShow(){}function appHide(a,b){}function pageOnunload(a,b){}function pageOnload(a,b){}function pageOnshow(a,b){var c="string"==typeof this.__route__?this.__route__:"系统没有取到值";sa.track("$MPViewScreen",{$url:c})}var _={},sa={};sa.para=require("sensorsdata_conf.js"),sa._queue=[],sa.getSystemInfoComplete=!1;var ArrayProto=Array.prototype,FuncProto=Function.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,LIB_VERSION="0.2",LIB_NAME="MiniProgram";sa.lib_version=LIB_VERSION;var logger="object"==typeof logger?logger:{};logger.info=function(){if("object"==typeof console&&console.log)try{return console.log.apply(console,arguments)}catch(a){console.log(arguments[0])}},function(){var a=(FuncProto.bind,ArrayProto.forEach),b=ArrayProto.indexOf,c=Array.isArray,d={},e=_.each=function(b,c,e){if(null==b)return!1;if(a&&b.forEach===a)b.forEach(c,e);else if(b.length===+b.length){for(var f=0,g=b.length;g>f;f++)if(f in b&&c.call(e,b[f],f,b)===d)return!1}else for(var h in b)if(hasOwnProperty.call(b,h)&&c.call(e,b[h],h,b)===d)return!1};_.logger=logger,_.extend=function(a){return e(slice.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])}),a},_.extend2Lev=function(a){return e(slice.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(_.isObject(b[c])&&_.isObject(a[c])?_.extend(a[c],b[c]):a[c]=b[c])}),a},_.coverExtend=function(a){return e(slice.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&void 0===a[c]&&(a[c]=b[c])}),a},_.isArray=c||function(a){return"[object Array]"===toString.call(a)},_.isFunction=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(b){return!1}},_.isArguments=function(a){return!(!a||!hasOwnProperty.call(a,"callee"))},_.toArray=function(a){return a?a.toArray?a.toArray():_.isArray(a)?slice.call(a):_.isArguments(a)?slice.call(a):_.values(a):[]},_.values=function(a){var b=[];return null==a?b:(e(a,function(a){b[b.length]=a}),b)},_.include=function(a,c){var f=!1;return null==a?f:b&&a.indexOf===b?-1!=a.indexOf(c):(e(a,function(a){return f||(f=a===c)?d:void 0}),f)}}(),_.trim=function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},_.isObject=function(a){return"[object Object]"==toString.call(a)&&null!=a},_.isEmptyObject=function(a){if(_.isObject(a)){for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}return!1},_.isUndefined=function(a){return void 0===a},_.isString=function(a){return"[object String]"==toString.call(a)},_.isDate=function(a){return"[object Date]"==toString.call(a)},_.isBoolean=function(a){return"[object Boolean]"==toString.call(a)},_.isNumber=function(a){return"[object Number]"==toString.call(a)&&/[\d\.]+/.test(String(a))},_.isJSONString=function(a){try{JSON.parse(a)}catch(b){return!1}return!0},_.decodeURIComponent=function(a){var b="";try{b=decodeURIComponent(a)}catch(c){b=a}return b},_.encodeDates=function(a){return _.each(a,function(b,c){_.isDate(b)?a[c]=_.formatDate(b):_.isObject(b)&&(a[c]=_.encodeDates(b))}),a},_.formatDate=function(a){function b(a){return 10>a?"0"+a:a}return a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+" "+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+"."+b(a.getMilliseconds())},_.searchObjDate=function(a){_.isObject(a)&&_.each(a,function(b,c){_.isObject(b)?_.searchObjDate(a[c]):_.isDate(b)&&(a[c]=_.formatDate(b))})},_.formatString=function(a){return a.length>sa.para.max_string_length?(logger.info("字符串长度超过限制，已经做截取--"+a),a.slice(0,sa.para.max_string_length)):a},_.searchObjString=function(a){_.isObject(a)&&_.each(a,function(b,c){_.isObject(b)?_.searchObjString(a[c]):_.isString(b)&&(a[c]=_.formatString(b))})},_.unique=function(a){for(var b,c=[],d={},e=0;e<a.length;e++)b=a[e],b in d||(d[b]=!0,c.push(b));return c},_.strip_sa_properties=function(a){return _.isObject(a)?(_.each(a,function(b,c){if(_.isArray(b)){var d=[];_.each(b,function(a){_.isString(a)?d.push(a):logger.info("您的数据-",b,"的数组里的值必须是字符串,已经将其删除")}),0!==d.length?a[c]=d:(delete a[c],logger.info("已经删除空的数组"))}_.isString(b)||_.isNumber(b)||_.isDate(b)||_.isBoolean(b)||_.isArray(b)||(logger.info("您的数据-",b,"-格式不满足要求，我们已经将其删除"),delete a[c])}),a):a},_.strip_empty_properties=function(a){var b={};return _.each(a,function(a,c){null!=a&&(b[c]=a)}),b},_.utf8Encode=function(a){a=(a+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var b,c,d,e="",f=0;for(b=c=0,f=a.length,d=0;f>d;d++){var g=a.charCodeAt(d),h=null;128>g?c++:h=g>127&&2048>g?String.fromCharCode(g>>6|192,63&g|128):String.fromCharCode(g>>12|224,g>>6&63|128,63&g|128),null!==h&&(c>b&&(e+=a.substring(b,c)),e+=h,b=c=d+1)}return c>b&&(e+=a.substring(b,a.length)),e},_.base64Encode=function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;a=_.utf8Encode(a);do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m},_.info={properties:{$lib:LIB_NAME,$lib_version:String(LIB_VERSION),$user_agent:"SensorsAnalytics MP SDK"},getSystem:function(){function a(){wx.getNetworkType({success:function(a){c.$network_type=a.networkType},complete:b})}function b(){wx.getSystemInfo({success:function(a){c.$model=a.model,c.$screen_width=Number(a.windowWidth),c.$screen_height=Number(a.windowHeight),c.$os=a.system.split(" ")[0],c.$os_version=a.system.split(" ")[1]},complete:d.setStatusComplete})}var c=this.properties,d=this;a()},setStatusComplete:function(){sa.getSystemInfoComplete=!0,sa._queue.length>0&&(_.each(sa._queue,function(a){sa.prepareData.apply(sa,slice.call(a))}),sa._queue=[])}},sa._=_,sa.prepareData=function(a,b){if(!sa.getSystemInfoComplete)return sa._queue.push(arguments),!1;var c={distinct_id:this.store.getDistinctId(),lib:{$lib:LIB_NAME,$lib_method:"code",$lib_version:String(LIB_VERSION)},properties:{}};_.extend(c,a),_.isObject(a.properties)&&!_.isEmptyObject(a.properties)&&_.extend(c.properties,a.properties),a.type&&"profile"===a.type.slice(0,7)||(c.properties=_.extend({},_.info.properties,c.properties)),c.properties.$time&&_.isDate(c.properties.$time)?(c.time=1*c.properties.$time,delete c.properties.$time):sa.para.use_client_time&&(c.time=1*new Date),_.searchObjDate(c),_.searchObjString(c),sa.send(c,b)},sa.store={getUUID:function(){return""+Date.now()+"-"+Math.floor(1e7*Math.random())+"-"+Math.random().toString(16).replace(".","")+"-"+String(31242*Math.random()).replace(".","").slice(0,8)},setStorage:function(){},getStorage:function(){return wx.getStorageSync("sensorsdata2015_wechat")||""},_state:{},toState:function(a){var b=null;_.isJSONString(a)?(b=JSON.parse(a),b.distinct_id?this._state=b:this.set("distinct_id",this.getUUID())):this.set("distinct_id",this.getUUID())},getFirstId:function(){return this._state.first_id},getDistinctId:function(){return this._state.distinct_id},set:function(a,b){this._state=this._state||{},this._state[a]=b,this.save()},save:function(){wx.setStorageSync("sensorsdata2015_wechat",JSON.stringify(this._state))},init:function(){var a=this.getStorage();a?this.toState(a):this.set("distinct_id",this.getUUID())}},sa.setProfile=function(a,b){sa.prepareData({type:"profile_set",properties:a},b)},sa.setOnceProfile=function(a,b){sa.prepareData({type:"profile_set_once",properties:a},b)},sa.track=function(a,b,c){this.prepareData({type:"track",event:a,properties:b},c)},sa.trackSignup=function(a,b,c,d){sa.prepareData({original_id:sa.store.getFirstId()||sa.store.getDistinctId(),distinct_id:a,type:"track_signup",event:b,properties:c},d),sa.store.set("distinct_id",a)},sa.register=function(){},sa.login=function(a){var b=sa.store.getFirstId(),c=sa.store.getDistinctId();a!==c&&(b?sa.trackSignup(a,"$SignUp"):(sa.store.set("first_id",c),sa.trackSignup(a,"$SignUp")))},sa.init=function(){this._.info.getSystem(),this.store.init(),_.isObject(this.para.register)&&(_.info.properties=_.extend(_.info.properties,this.para.register))},sa.send=function(a){var b=0,c="";a._nocache=(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15),logger.info(a),a=JSON.stringify(a),c=-1!==sa.para.server_url.indexOf("?")?sa.para.server_url+"&data="+encodeURIComponent(_.base64Encode(a)):sa.para.server_url+"?data="+encodeURIComponent(_.base64Encode(a));var d=function(){wx.request({url:c,method:"GET",fail:function(){logger.info("发送错误，重新发送"),2>b&&(b++,d())}})};d()};var p=App;App=function(a){e(a,"onLaunch",appLaunch),e(a,"onShow",appShow),e(a,"onHide",appHide),p(a)};var v=Page;Page=function(a){e(a,"onLoad",pageOnload),e(a,"onUnload",pageOnunload),e(a,"onShow",pageOnshow),e(a,"onHide",pageOnunload),v(a)},module.exports=sa;